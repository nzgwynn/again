\documentclass[]{sagej}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Matching in Cluster Randomized Trials Using the Glodilocks Approach},
            pdfkeywords={cluster-randomized trials, matching},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{plainnat}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{Matching in Cluster Randomized Trials Using the Glodilocks Approach}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{true}
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{June 19, 2017}


\begin{document}
\maketitle
\begin{abstract}
Matching in cluster-randomized trials (CRTs) is important, but there is
no best practice. When baseline data is available, we suggest a
technique which can be used to identify the best weighting of pertinent
variables to enable more balance between treatment and control groups.
This technique involves standardizing the variables, computing the
Mahalanobis distance, use matching to find pairs, then randomizing and
rerandomizing. For each randomiziation we compute the difference in the
treatment and control arms for each variable and plot these on a
parallel-coordinates plot. Investigators can compare plots to identify
weighting for advantageous randomization schema.
\end{abstract}

\subsection{Introduction}\label{introduction}

To determine the efficacy of a treatment, individually randomized trials
(IRTs) with blinding are the ``strongest study design available''
\citep{gatsonis2017methods}. Unfortunately, cost and study design
amongst other things mean some interventions can not be randomized on an
individual level. For example, education researchers decide to determine
if training elementary school teachers in a reading program will affect
literacy skills in third graders. Randomizing each third grader to
treatment or control would not be suitable, as this equates to randomly
allocating students to a teacher; rural schools tend to be smaller with
only one teacher which further complicates matters. Instead, researchers
may choose to randomize teachers, schools, or counties to determine any
differences between the two arms of the study. Trials where groups are
randomized are called cluster randomized trials (CRTs). Three reasons
for conducting a CRTs are: (i) implementation occurs at the cluster
level, (ii) to avoid contamination, and (iii) to measure intervention
effects among cluster members who do not receive treatment
\citep{balzer2012match, CRTrials2009}. CRTs are ``the gold standard when
allocation of identifiable groups is necessary''
\citep{murray2004design}.

One challenge in CRTs is their limited sample size. Most CRTs have less
than 30 independent units to randomise, though each unit may have
thousands of dependent individuals \citep{balzer2012match}. In IRTs,
investigators expect randomisation to balance confounders across each
arm of the trial, but the reduced size of CRTs makes this unlikely.
Grouping similar units together, then randomizing, is one solution to
this. Scholars debate the sizes of these groups, in particular,
matching, which involves grouping 2 units together, and stratifying,
where many more than 2 units are grouped\citep{PMVsStrat}. This article
discusses matching.

Many authors debate matching in CRTs
\citep{balzer2012match, CRTrials2009, gatsonis2017methods, diehr1995breaking, murray1998design, imai2009essential, PMVsStrat, donner2007merits, klar1997merits, donner2000design, martin1993effect}.
Murray argues that ``the choice of matching or stratification {[}of{]}
factors is critical to the success of the procedure''
\citep{murray1998design}. Some agree that caution must be used when
matching a small number of clusters due to the decrease in power
\citep{donner2000design, klar1997merits, balzer2012match, martin1993effect}.
Breaking matches in the analysis stage addresses this
\citep{diehr1995breaking}, but perhaps only when there are a small
number of large clusters \citep{donner2007merits}. Others argue that
matching is effective in a small number of clusters as it ``increases
the chance of the intervention groups being well-balanced''
\citep{donner2007merits}. Imai et al argue that not matching, in small
or large sample, is ``equivalent to discarding a considerable fraction
of one's data'' \citep{imai2009essential}. However, in one trial
``matching actually led to a loss in statistical efficiency''
\citep[\citet{donner2000design}]{manun1994influence}. Despite all this
debate few authors discuss methodologies to support the matching process
\citep{raab2001balance}.

Our article is an extension of methods introduced in Chapter 4 of
Methods in Comparative Effectiveness Research
\citep{gatsonis2017methods}. We suggest a method suitable for \(a\)
\(priori\) matching using baseline data. In section 2 we outline our
method, section 3 applies it to the SWAPOUT dataset, and section 4 is a
brief discussion.

\subsection{Methods }\label{methods}

To approach this complex topic of balancing randomization in CRTs we
suggest a new approach. Our approach involves controlling the strength
of the matching on variables of import, and randomizing many times to
obtain a distribution of possibilities when official randomization
occurs. Investigators assess these distributions to determine if
possible randomizations are sufficiently balanced, if not, the strength
criteria is adjusted and the process begins again. The details follow.

The initial step involves prioritizing variables \((1, 2,..., n)\) from
units \((1, 2, ..., m)\) to be randomized. We have

\begin{eqnarray*}
 \overline{V_1} & = & (v_{11}, v_{12},..., v_{1n})\\
 \overline{V_2} & = & (v_{21}, v_{22},..., v_{2n})\\
 \vdots & = & \vdots\\    
 \overline{V_m} & = & (v_{m1}, v_{m2},..., v_{mn})\\
\end{eqnarray*}

where \(v_{ij}\) is the \(i^{th}\) variable from unit \(j\): each
\(\overline{V_i}\) contains pertinent variables from unit \(i\). From
here, we compute the Mahalanobois Distance matrix, \textbf{D}, by
finding
\(d(\overline{V_i}, \overline{V_j}) = \sum_{k=1}^n \frac{(v_{ik} - v_{jk})^2}{s_k^2}\)
where
\(s_k^2 = \frac{1}{m} \sum_{l=1}^m(v_{lk} - \overline{v_{\cdot k}})\)
and \(\overline{v_{\cdot k}} = \frac{1}{n} \sum_{i = 1}^m v_{ik}\). Then
we use the \texttt{nmatch} function in the \texttt{designmatch}
\citep{doi} package in \texttt{R} \citep{nmatch} to find \(\frac{m}{2}\)
pairs if \(m\) is even. If \(m\) is odd, the last unit should be placed
in both treatment and control group for exploratory purposes. Without
loss of generality, we assume \(m\) is even for the remainder of this
paper and note that to include an odd \(m\) either treatment or control
groups will include one more set of priority variables and the addition
of 1 in the denominator of \(d_i\).

Once the matching is completed and we have pairs
\((\overline{C_{11}}, \overline{C_{12}}), (\overline{C_{21}}, \overline{C_{22}}), ..., (\overline{C_{\frac{m}{2}1}}, \overline{C_{\frac{m}{2}2}}).\)
KEN I'M NOT SURE HOW THIS FOLLOWS THROUGH!!!!! The first match in each
pair will be randomized to either treatment or control, the second to
the remainder. Next, we subset
\(\overline{V_1}, \overline{V_2}, ..., \overline{V_m}\) into appropriate
randomization subgroups:
\(\overline{V_{1T}}, \overline{V_{1C}}, \overline{V_{2T}}, \overline{V_{2C}},..., \overline{V_{\frac{m}{2}T}}, \overline{V_{\frac{m}{2}C}}\)
where \(\overline{V_{iT}} = (v_{i1}^T, v_{i2}^T,..., v_{in}^T),\)
similarly for \(\overline{V}_{iC}.\) Using these we find

\begin{eqnarray*}
 d_i = \frac{| \sum_{j = 1}^{\frac{m}{2}}v_{ij}^T - \sum_{j = 1}^{\frac{m}{2}}v_{ij}^C |}{\frac{m}{2}} 
\end{eqnarray*}

for \(i = 1, 2, ..., n.\) We randomize \(R\) times and find \(d_{ij}\)
the average difference in the two arms for the \(i^{th}\) priority
variable for each of the \(j = 1, 2, ..., R\) re-randomizations. To
visualize we draw a parallel coordinates plot where the \(i^{th}\) axis
plots all \(d_{ij}\) for \(j = 1, 2, ..., R.\)

If the investigators find the distribution of possible randomizations
unacceptable for a priority variable \(j\), we introduce
\(\overline{S} = (s_{1}, s_{2},..., s_{n})\), which controls the
strength of matching on that variable. We have

\begin{eqnarray*}
 v_{ij}^* = \prod_{i=1}^{m} v_{ij} \times s_j
\end{eqnarray*}

which we combine to form

\begin{eqnarray*}
 \overline{V_1^*} & = & (v_{11}^*, v_{12}^*,..., v_{1n}^*) \\
 \overline{V_2^*} & = & (v_{21}^*, v_{22}^*,..., v_{2n}^*) \\
 \vdots & = & \vdots\\    
 \overline{V_m^*} & = & (v_{m1}^*, v_{m2}^*,..., v_{mn}^*) .\\
\end{eqnarray*}

and re-run the matching to attain stronger matches for the variable
\(j\). We again find \(d_{ij}\) and plot them. The penality in this
process is that closer matches for variable \(j\) are likely to imply
reduced closeness in another variable, so compromises must be made.

\subsection{Results}\label{results}

To demonstrate the usefulness of this technique we present a brief
summary of our randomization process using baseline data from the
SWAPOUT trial (Cluster-randomized Non-inferiority Trial Comparing
Mupirocin vs Iodophor for Nasal Decolonization of ICU Patients to Assess
Impact on Staphylococcus aureus Clinical Cultures and All-cause
Bloodstream Infection During Routine Chlorhexidine Bathing)
\citep{SOTrial}. In this non-inferiority trial, the investigators are
studying whether bathing with chlorhexidine gluconate and swabbing
iodophor nasal swabs are inferior to bathing with the same and mupirocin
nasal swabs. In the REDUCE trial \citep{huang2013targeted} mupirocin
nasal swabs and bathing with chlorhexidine reduced the MRSA
Staphylococcus aureus (an antibiotic resistant infection) in Hospital
Corporation of America intensive care units (ICU). However, physicians
are reluctant to use mupirocin, an antibiotic, so investigators are
assessing ``swapping''" it with iodophor.

\begin{longtable}[]{@{}lllll@{}}
\caption{Abbreviations of variables used to randomize}\tabularnewline
\toprule
Primary & Secondary & Tetiary & Quaternary & Quinary\tabularnewline
\midrule
\endfirsthead
\toprule
Primary & Secondary & Tetiary & Quaternary & Quinary\tabularnewline
\midrule
\endhead
Pt Days & Median LOS & Medicaid & DC SNF & Onc\_BMT\_Trp\tabularnewline
S auer Rate & Comorbidity Score & PCR Blood & Surgery &
BMT\_Trp\tabularnewline
MRSA Rate &\tabularnewline
All Blood &\tabularnewline
Mup-R &\tabularnewline
Hx MRSA &\tabularnewline
Mup Adherence &\tabularnewline
CHG Adherence &\tabularnewline
\bottomrule
\end{longtable}

A COMMENT YOU MADE WAS HERE - DATA FROM EMRS/billing records - UNSURE
WHAT THIS MEANS!!!!

Prior to randomization baseline data was collected for 20 months on the
137 hospitals. With this data, investigators met to prioritize baseline
variables into several categories: primary, secondary, tertiary,
quaternary, quinary, and not relevant to randomization. For this trial,
the investigators decided that average monthly attributable days,
Staphylococcus aureus Intensive Care Unit (ICU)-attributable cultures
per 1,000 days, MRSA ICU-attributable cultures per 1,000 days, all
pathogen ICU-attributable bacteremia cultures per 1,000 days, regional
mupirocin resistance estimate, percent of admissions with MRSA diagnosis
within a year, percent of mupirocin use admission to day 5, survey
Chlorhexidine Glucominate were all of primary importance. Of secondary
importance were median ICU length of stay, and mean elixhauser total
score. Of tertiary importance were the percentage of ICU medicaid
patients, and whether or not a facility uses Polymerase chain reactions
to identify MRSA in blood. Next, percent admissions to skilled nursing
facility (SNF), and the percent of admissions with Center for Disease
Control and Prevention surveillance surgery. Lastly, if the ICU has
specialty units for oncology, bone marrow transplant, or transplant
units, and if the ICU has bone marrow transplant or transplant units.
More information on each variable is avaliable in appendix 1 and their
abbreviations, in the same order, can be found in table 1. To ease
understanding, our initial discussion will involve the first 3 variables
above: Patient days, Staphylococcus aureus rate, and MRSA rate.

\begin{center}\includegraphics{Bins_files/figure-latex/IntroGraph-1} \end{center}

Prior to randomization, investigators spent time using a web application
built using the \texttt{Shiny} package in \texttt{R}. The purpose of
this is to help investigators explore the strengths of matching on
multiple variables to see what gives advantageous balance across
relevant baseline variables. We recommend deciding on ideal and
acheivable maximum differences in study arms and using many combinations
of strengths of matching until one is found which ensures randomization
is likely to be within those bounds. In the well-known childrens fable
The Three Bears, Goldilocks tries three bowls of porridge, one is too
hot, the other too cold, and the third is just right \citep{3Bears}. We
recommend a similar procedure applied to strengths of matching, with
perhaps more attempts.

Figure 1 demonstrates this process using three variables: attributable
patient days per month, Staphylococcus auereus rate, and MRSA rate.
After initial explorations on the web application, investigators agreed
that an ideal maximum mean differences in treatment and control arms for
these variables were: 80 attributable patient days per month, 15\%
difference in Staphylococcus aureus infection rates, and 15\% difference
in MRSA rate. The graph on the top left shows no strength of matching on
any of these variables, the values exceed the maximums in the second and
third axis: there is a reasonable chance that if randomization occured
with this weighting the Staphylococcus aureus and MRSA rate would be
above the desired maximum mean differences in treatment and control
arms. To rectify this, positive strengths must be added. In the
top-right graph a strength of 8 has been applied to the Staphylococcus
auereus rate. In this graph, the matching of hospitals is strongly
ajusted so that hospitals with similar Staphylococcus auereus rates are
paired. This results in low mean difference between the treatment and
control arms in that variable. The values on the middle axis are below
the maximum value: if randomization occured using these strengths we are
likely to get suitable balance in this variable. Unfortunately, there is
a penalty. Hospitals with similar Staphylococcus auereus rates do not
have similar attributable patient days per month and MRSA rates, which
results in these values exceeding the maximum. In particular, our
investigators felt that the chance of attaining MRSA rates above 15\%
were too high for these strengths. The bottom plot shows the possible
mean balances used in the actual randomization for these three
variables, the strengths of matching for each variable were 1, 4, and 2,
respectively. In all graphs, the black line indicates the mean value of
all points on each axis.

Our investigators used this approach with 16 variables. After trying
many strengths of matching they found one with the best balance between
treatment and control arms for the variables of importance. When the
trial was randomized we used these strength to match hospitals in the
study, then randomized the first member of each match to either
treatment control. The results can be seen in Figure 2.

One variable in Figure 2, median length of stay, is fixed on one value.
For this variable, all computed randomisations had the same mean
difference in median length of stay in the control and treatment arm.
When randomisation occurs we can be almost certain that we will attain
this mean difference in median length of stay in the treatment and
control arms.

\begin{center}\includegraphics{Bins_files/figure-latex/FullGraph-1} \end{center}

\subsection{Discussion}\label{discussion}

While the Goldilocks approach to randomizing does not ensure balance in
the treatment and control arms, it is a tool that provides investigators
with a method to explore strengths of matching that impact matching and
balance. We encourage investigators that utilize CRTs to use this method
prior to randomizing to find more balance in treatment and control arms.

In matching for SWAPOUT, we standardized all \(16\) variables by
subtracting the mean from each value, then dividing by the standard
deviation. To simplify notation, we reduced the algorithm as this
impacts the initial plot, but the process remains the same. In SWAPOUT,
the \(d_{ij}\) is derived from the nonstandardized data, the
standardized data was solely used for matching.

If investigators would like to use this method on studies with more than
\(2\) arms, \(d_{ij}\) can be found for multiple combinations of arms
and multiple plots can be assessed.

Future work in this area includes publishing a \texttt{Shiny} web
application for investigators to utilise. This application will
eventually be an interactive plot that enables users to click on each
axis and view where low and high draws of that variable fall for other
variables. In some cases, our investigators find that matching on 1
variable seems to give suitable balance throughout.

\subsection{Appendix}\label{appendix}

A more formal explanation of the variables here, in table format, to be
checked with Susan.

\begin{longtable}[]{@{}ll@{}}
\toprule
Variable & Description\tabularnewline
\midrule
\endhead
Pt Days &\tabularnewline
S auer Rate &\tabularnewline
MRSA Rate &\tabularnewline
All Blood &\tabularnewline
Mup-R &\tabularnewline
Hx MRSA &\tabularnewline
Mup Adherence &\tabularnewline
CHG Adherence &\tabularnewline
Median LOS &\tabularnewline
Medicaid &\tabularnewline
Comorbidity Score &\tabularnewline
Medicaid &\tabularnewline
PCR Blood &\tabularnewline
DC SNF &\tabularnewline
Surgery &\tabularnewline
Onc\_BMT\_Trp &\tabularnewline
BMT\_Trp &\tabularnewline
\bottomrule
\end{longtable}

Table 2: Thorough description of baseline variables used in this paper.

\bibliography{bibliography.bib}


\end{document}
